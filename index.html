<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Pendataan Guru Sertifikasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

  <!-- Navbar -->
  <div class="bg-indigo-700 text-white py-3 shadow-lg flex justify-between px-6">
    <h1 class="text-xl font-bold"><i class="fa-solid fa-graduation-cap mr-2"></i>Pendataan Guru Sertifikasi</h1>
    <div>
      <button onclick="showSection('dashboard')" class="mx-1 px-3 py-1 bg-indigo-500 rounded">Dashboard</button>
      <button onclick="showSection('form')" class="mx-1 px-3 py-1 bg-indigo-500 rounded">Input Data</button>
      <button onclick="showSection('rekap')" class="mx-1 px-3 py-1 bg-indigo-500 rounded">Rekap Data</button>
    </div>
  </div>

  <div class="p-6 max-w-6xl mx-auto">
    <!-- DASHBOARD -->
    <section id="dashboard">
      <h2 class="text-2xl font-bold text-indigo-700 mb-4">📊 Dashboard</h2>
      <div id="dashboardStats" class="grid md:grid-cols-3 gap-4 text-center"></div>
      <canvas id="chartDistribusi" class="mt-6"></canvas>
    </section>

    <!-- FORM -->
    <section id="form" class="hidden">
      <h2 class="text-2xl font-bold text-indigo-700 mb-4">📝 Input Data Guru</h2>
      <form id="guruForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-6 rounded-xl shadow-lg">

        <div>
          <label>Status Sertifikasi</label>
          <select id="statusSertifikasi" class="border p-2 w-full rounded">
            <option value="">Pilih</option>
            <option value="Sudah Sertifikasi">Sudah Sertifikasi</option>
            <option value="Belum Sertifikasi">Belum Sertifikasi</option>
          </select>
        </div>

        <div><label>Nama Lengkap</label><input id="namaLengkap" class="border p-2 w-full rounded"></div>
        <div><label>NRG</label><input id="nrg" class="border p-2 w-full rounded"></div>
        <div><label>Tempat Lahir</label><input id="tempatLahir" class="border p-2 w-full rounded"></div>
        <div><label>Tanggal Lahir</label><input type="date" id="tanggalLahir" class="border p-2 w-full rounded"></div>
        <div><label>Jenis Kelamin</label><select id="jenisKelamin" class="border p-2 w-full rounded"><option>Laki-laki</option><option>Perempuan</option></select></div>
        <div><label>Agama</label><input id="agama" class="border p-2 w-full rounded"></div>
        <div><label>No. Telepon</label><input id="noTelepon" class="border p-2 w-full rounded"></div>
        <div class="col-span-2"><label>Alamat</label><textarea id="alamat" class="border p-2 w-full rounded"></textarea></div>
        <div><label>Status Kepegawaian</label><input id="statusKepegawaian" class="border p-2 w-full rounded"></div>
        <div><label>Nama Sekolah</label><select id="namaSekolah" class="border p-2 w-full rounded">
          <option>SMP Fajar</option><option>SMK Fajar</option><option>SMK Mutiara Insani</option>
        </select></div>
        <div><label>Bidang Studi S1</label><input id="bidangStudiS1" class="border p-2 w-full rounded"></div>
        <div><label>Mata Pelajaran di Sekolah</label><input id="mapel" class="border p-2 w-full rounded"></div>
        <div><label>Email Belajar.id</label><input id="emailBelajar" class="border p-2 w-full rounded"></div>
        <div><label>Email Pribadi</label><input id="emailPribadi" class="border p-2 w-full rounded"></div>
        <div><label>Jenis Sertifikasi</label><input id="jenisSertifikasi" class="border p-2 w-full rounded"></div>
        <div><label>Bidang Studi Sertifikasi</label><input id="bidangSertifikasi" class="border p-2 w-full rounded"></div>
        <div><label>Tanggal Mulai Berlaku</label><input type="date" id="tanggalMulaiBerlaku" class="border p-2 w-full rounded"></div>
        <div><label>Nomor Peserta Sertifikasi/PLPG</label><input id="nomorPeserta" class="border p-2 w-full rounded"></div>

        <div class="col-span-2 flex justify-end mt-4 gap-3">
          <button type="button" id="isiDummy" class="bg-amber-500 px-4 py-2 rounded text-white">Isi Dummy</button>
          <button type="submit" class="bg-indigo-600 px-4 py-2 rounded text-white">Kirim</button>
        </div>
      </form>
      <p id="notif" class="text-center mt-4 font-bold"></p>
    </section>

    <!-- REKAP -->
    <section id="rekap" class="hidden">
      <h2 class="text-2xl font-bold text-indigo-700 mb-4">📋 Rekap Data Guru</h2>
      <table id="rekapTable" class="w-full text-sm border-collapse bg-white rounded-lg overflow-hidden shadow">
        <thead class="bg-indigo-600 text-white"><tr id="headerRow"></tr></thead>
        <tbody id="bodyTable"></tbody>
      </table>
    </section>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyq6NGYYvDfjSHZkr-HG_qsDhiJ12zqk4Z9n19ukcoWMzw_OhQRoN-lAx9r1zVftKsr/exec"; // ganti dgn URL Web App

function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// === FETCH DASHBOARD DATA ===
async function loadDashboard(){
  const res = await fetch(SCRIPT_URL);
  const data = await res.json();
  if(!data.success) return;

  // Statistik
  const el = document.getElementById("dashboardStats");
  el.innerHTML = `
    <div class='bg-indigo-100 p-4 rounded shadow'>Total Guru: <b>${data.totalGuru}</b></div>
    <div class='bg-green-100 p-4 rounded shadow'>Sudah Sertifikasi: <b>${data.sudah}</b></div>
    <div class='bg-red-100 p-4 rounded shadow'>Belum Sertifikasi: <b>${data.belum}</b></div>`;

  // Chart Distribusi
  const ctx = document.getElementById("chartDistribusi");
  new Chart(ctx,{
    type:"doughnut",
    data:{
      labels:Object.keys(data.distribusi),
      datasets:[{data:Object.values(data.distribusi),backgroundColor:["#60a5fa","#34d399","#f472b6"]}]
    }
  });

  // Rekap
  const headerRow = document.getElementById("headerRow");
  headerRow.innerHTML = Object.keys(data.data[0]||{}).map(h=>`<th class='p-2 border'>${h}</th>`).join("");
  const body = document.getElementById("bodyTable");
  body.innerHTML = data.data.map(r=>`<tr>${Object.values(r).map(v=>`<td class='border p-1'>${v||""}</td>`).join("")}</tr>`).join("");
}

loadDashboard();

// === SUBMIT FORM ===
document.getElementById("guruForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const notif = document.getElementById("notif");
  const form = e.target;
  const data = {};
  form.querySelectorAll("input, select, textarea").forEach(f=>data[f.id]=f.value);

  notif.innerHTML="⏳ Mengirim...";
  try{
    const res = await fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify(data)});
    const json = await res.json();
    notif.innerHTML = json.success ? "✅ Data berhasil disimpan!" : "❌ Gagal: "+json.error;
    form.reset();
    loadDashboard();
  }catch(err){
    notif.innerHTML = "⚠️ Koneksi gagal: "+err.message;
  }
});

// === DUMMY BUTTON ===
document.getElementById("isiDummy").addEventListener("click", ()=>{
  const d = {
    statusSertifikasi:"Sudah Sertifikasi", namaLengkap:"Soni Haji", nrg:"9988776655",
    tempatLahir:"Bogor", tanggalLahir:"1988-06-15", jenisKelamin:"Laki-laki", agama:"Islam",
    noTelepon:"081234567890", alamat:"Jl. Pendidikan No.10 Rumpin", statusKepegawaian:"PNS",
    namaSekolah:"SMK Fajar", bidangStudiS1:"Teknologi Informasi", mapel:"Informatika",
    emailBelajar:"sonihaji@belajar.id", emailPribadi:"sonihaji@gmail.com",
    jenisSertifikasi:"PPG", bidangSertifikasi:"Informatika", tanggalMulaiBerlaku:"2025-01-01",
    nomorPeserta:"PPG2025-001"
  };
  Object.entries(d).forEach(([id,val])=>document.getElementById(id).value=val);
  alert("✅ Dummy data diisi otomatis. Klik Kirim untuk uji coba!");
});
</script>
</body>
</html>
